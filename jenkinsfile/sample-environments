#!/usr/bin/env groovy
pipeline {

    agent any

    options {
        timestamps()
        disableConcurrentBuilds()
        timeout(time: 1, unit: 'MINUTES')
    }

    stages {
        stage('DESCRIPTION') {
            steps {
                echo("""
                This demo is made for build environment variables :
                
                Requirements :
                * Set new credentials : ${JENKINS_URL}credentials/store/system/domain/_/newCredentials
                  * Type : username & password
                  * ID : 'username-id'
                  * Username :

                Pipeline description :
                * ENVIRONMENTS : Show all available environments variables
                * ENVIRONMENTS STAGE : Set a environment variable and show it's value
                * ENVIRONMENTS WITH CREDENTIALS : Set some secrets in environment variable and print all available environments variables

                Documentation : https://jenkins.io/doc/book/pipeline/syntax/#environment
                """)
            }
        }
        stage('ENVIRONMENTS') {
            steps {
                echo('Print environments variables')
                sh('env')
            }
        }
        stage('ENVIRONMENTS WITH STAGE VALUE') {
            environment { 
                SAMPLE_ENV_VAR = 'ENV_VAR_VALUE'
            }
            steps {
                echo("SAMPLE_ENV_VAR variables can be use : ${SAMPLE_ENV_VAR}")
            }
        }
        stage('ENVIRONMENTS WITH CREDENTIALS') {
            environment { 
                SECRET = credentials('username-id')
            }
            steps {
                echo("Set the key 'username-id' in your secret here : ${JENKINS_URL}credentials/store/system/domain/_/newCredentials")
                sh('env')
            }
        }
    }
}