// WIP
pipeline {

    agent any

    options {
        timestamps()
        disableConcurrentBuilds()
        timeout(time: 1, unit: 'MINUTES')
    }

    parameters {
        string(name: 'RELEASE_NAME', defaultValue: '0.0.1', description: 'What is the name of this release ?')
        booleanParam(name: 'SEND_EMAIL', defaultValue: true, description: 'Send a fake email')
    }

    stages {
        stage('SIMPLE CONDITION') {
            when {
                anyOf {
                     branch 'master'
                     expression { BRANCH_NAME ==~ /feature\/.*/ }
                }
               
            }
            steps {
                echo('CONDITION - Executed (Only on master and feature/* branch) !')
            }
        }
        stage('RELEASE CONDITION') {
            // when {
            //     beforeInput true
            // }
            input {
                message "Proceed ?"
                ok "Deploy the release ${env.RELEASE_NAME}"
                parameters {
                    string(name: 'CONTINUE', defaultValue: 'NO', description: 'XXXX')
                }
            }
            steps {
                echo('CONDITION - Executed !')
                sh('env')
            }
        }
        stage('EMAIL CONDITION - INSIDE DOCKER') {
            when {
                environment name: 'SEND_EMAIL', value: '1'
            }
            steps {
                echo('DOCKER CONDITION - Execute fake send email')
                sh('env')
            }
        }
        
    }
    
}