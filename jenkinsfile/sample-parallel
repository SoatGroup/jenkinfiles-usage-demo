#!/usr/bin/env groovy
pipeline {

    agent any

    options {
        timestamps()
        disableConcurrentBuilds()
        timeout(time: 1, unit: 'MINUTES')
        buildDiscarder(logRotator(numToKeepStr: '1'))
    }

    stages {
        stage('DESCRIPTION') {
            steps {
                echo("""
                This demo is made for parallel stage execution :
                
                Pipeline description :
                * HELLO WORLD : Print a sample echo when the all steps end successfully
                * PARALLEL HELLO : Run several echo step in parallel
                * PARALLEL FAILURE : Run several error step in parallel

                Documentation :
                * https://jenkins.io/doc/book/pipeline/syntax/#post
                * See 'parallelsAlwaysFailFast' in options : https://jenkins.io/doc/book/pipeline/syntax/#options
                """)
            }
        }

        stage('HELLO WORLD') {
            steps {
                echo 'Hello from Jenkinsfile !'
            }
        }

        stage('PARALLEL HELLO') {
            parallel {
                stage('HELLO FROM BOB') {
                    steps {
                        echo 'Bob : Hello Jenkinsfile !'
                    }
                }
                stage('HELLO FROM ALICE') {
                    steps {
                        echo 'Alice : Hello Jenkinsfile !'
                    }
                }
                stage('HELLO FROM OSCAR') {
                    steps {
                        echo 'Oscar : Hello Jenkinsfile !'
                    }
                }
            }
        }

        stage('PARALLEL FAILURE') {
            failFast true
            parallel {
                stage('HELLO FROM BOB') {
                    steps {
                        error 'Bob : Hello Jenkinsfile !'
                    }
                }
                stage('HELLO FROM ALICE') {
                    steps {
                        error 'Alice : Hello Jenkinsfile !'
                    }
                }
                stage('HELLO FROM OSCAR') {
                    steps {
                        error 'Oscar : Hello Jenkinsfile !'
                    }
                }
            }
        }

    }

}